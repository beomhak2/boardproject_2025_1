<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="board2">
	<resultMap id="memberVO" type="com.project.page.board2.model.Member"  >
			<result property="userId" column="USER_ID"/>
		    <result property="pwd" column="PWD"/>
		    <result property="name" column="NAME"/>
		    <result property="email" column="EMAIL"/>
		    <result property="phone" column="PHONE"/>
		    <result property="regDt" column="REG_DT"/>
		    <result property="mdfDt" column="MDF_DT"/>
	</resultMap>
	
	<resultMap id="postVO" type="com.project.page.board2.model.Post" >
		<result property="rnum" column="RNUM"/>
		<result property="postId" column="POST_ID"/>
	    <result property="title" column="TITLE"/>
	    <result property="postContent" column="POST_CONTENT"/>
	    <result property="viewCnt" column="VIEW_CNT"/>
	    <result property="delYn" column="DEL_YN"/>
	    <result property="regDt" column="REG_DT"/>
	    <result property="mdfDt" column="MDF_DT"/>
	    <result property="boardId" column="BOARD_ID"/>
	    <result property="userId" column="USER_ID"/>
	    <collection property="member" resultMap="memberVO"/>
	</resultMap>
	
	<select id="total" resultType="Integer">
		SELECT COUNT(*) FROM post
	</select>

	<select id= "list" resultMap="postVO">
		SELECT * FROM (
			SELECT ROWNUM rnum, p.*
			FROM (
				SELECT *
				FROM post
				WHERE BOARD_ID = 2
				ORDER BY REG_DT
			) p
		)
		WHERE rnum BETWEEN (#{page} - 1) * #{perPage} + 1 AND (#{page} * #{perPage})
		ORDER BY rnum DESC
	</select>
	
	<insert id="add" parameterType="com.project.page.board2.model.Post">
		INSERT INTO post (
			POST_ID
			, TITLE
			, POST_CONTENT
			, DEL_YN
			, REG_DT
			, MDF_DT
			, BOARD_ID
			, USER_ID
		)
		VALUES (
			BOARD_SEQ.NEXTVAL
			, #{title}
			, #{postContent}
			, 'N'
			, SYSDATE
			, SYSDATE
			, 2
			, 'def456'
		)
	</insert>
	
	<select id="item" resultMap="postVO">
		SELECT p.*, m.email
		FROM post p
			INNER JOIN member m
			ON p.USER_ID = m.USER_ID
		WHERE P.POST_ID = #{postId}
			AND P.BOARD_ID = 2
	</select>
	
	<update id="update" parameterType="com.project.page.board2.model.Post">
		UPDATE post
		SET TITLE = #{title}
			, POST_CONTENT = #{postContent}
			, MDF_DT = SYSDATE
		WHERE POST_ID = #{postId}
			AND BOARD_ID = 2
	</update>
	
	<delete id="delete" parameterType="com.project.page.board2.model.Post">
		DELETE FROM post
		WHERE POST_ID = #{postId}
			AND BOARD_ID = 2
	</delete>

</mapper>
